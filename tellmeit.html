<script>
const CODE = "GHALER";
const SLOTS = 6;
const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
const slotsContainer = document.getElementById('slotsContainer');
const overlay = document.getElementById('overlay');
const doorgate = document.getElementById('doorgate');
const slotSound = document.getElementById('slotSound');
const successSound = document.getElementById('successSound');

const slotElems = [];
const slotValues = Array(SLOTS).fill('-');

for(let i=0;i<SLOTS;i++){
  const el = document.createElement('div');
  el.className='slot';
  
  const span = document.createElement('span');
  span.textContent = '-';
  el.appendChild(span);

  el.dataset.index=i;
  el.dataset.locked = "false";
  slotsContainer.appendChild(el);
  slotElems.push({el, span, value:'-'});

  el.addEventListener('click', ()=> {
    if(el.dataset.locked === "true") return;
    el.dataset.locked = "true";

    slotSound.currentTime=0;
    slotSound.play().catch(()=>{});
    setTimeout(()=>{ slotSound.pause(); slotSound.currentTime=0; }, 150);

    let current = slotElems[i].value;
    let nextIndex = letters.indexOf(current) + 1;
    if(nextIndex >= letters.length) nextIndex = 0;
    let nextLetter = letters[nextIndex];

    const oldSpan = slotElems[i].span;
    const newSpan = document.createElement('span');
    newSpan.textContent = nextLetter;
    newSpan.style.transform = 'translateY(-100%)'; // começa acima
    newSpan.style.filter = 'blur(4px)';
    el.appendChild(newSpan);

    // animação vertical
    oldSpan.style.transform = 'translateY(100%)';
    oldSpan.style.filter = 'blur(4px)';
    setTimeout(()=> {
      newSpan.style.transform = 'translateY(0)';
      newSpan.style.filter = 'blur(0px)';
    }, 10);

    setTimeout(()=> {
      el.removeChild(oldSpan);
      slotElems[i].span = newSpan;
      slotElems[i].value = nextLetter;
      slotValues[i] = nextLetter;
      el.dataset.locked = "false";
      checkCode();
    }, 310);
  });
}

function checkCode(){
  if(slotValues.includes('-')) return;
  const guess = slotValues.join('');
  if(guess===CODE){
    overlay.style.pointerEvents='auto';
    overlay.style.opacity=1;
    successSound.currentTime=0;
    successSound.play().catch(()=>{});
    // porta só aparece depois do código certo
    doorgate.style.opacity = 1;
  }
}
</script>
